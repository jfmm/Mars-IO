function drawChart(t,e,a){if(document.getElementById("temp-graph").innerHTML="",e)var r=JSON.parse(sessionStorage.getItem(a));else switch(t){case"f":var r=fahrenheitTemperatureArchive;break;case"c":var r=celsiusTemperatureArchive}var n={top:30,right:20,bottom:30,left:50},i=600-n.left-n.right,s=270-n.top-n.bottom,o=d3.time.scale().range([0,i]),l=d3.scale.linear().range([s,0]),c=d3.svg.axis().scale(o).orient("bottom").ticks(4),d=d3.svg.axis().scale(l).orient("left").ticks(5),p=d3.select("#temp-graph").append("div").attr("class","tooltip").style("opacity",0),u=d3.select("#temp-graph").append("svg").attr("width",i+n.left+n.right).attr("height",s+n.top+n.bottom).attr("viewBox","0,0,600,270").attr("preserveAspectRatio","xMidYMid").append("g").attr("transform","translate("+n.left+","+n.top+")"),m=[];r.forEach(function(t){t.date=new Date(t.date);var e=t.date.getFullYear();m.push(e.toString())});var h=[m[0],m[m.length-1]];d3.select("#year-range").text(h[0]===h[1]?h[0]:h[0]+"-"+h[1]),o.domain(d3.extent(r,function(t){return t.date})),l.domain([d3.min(r,function(t){return t.min_temp}),d3.max(r,function(t){return t.max_temp})]);var g=d3.svg.line().x(function(t){return o(t.date)}).y(function(t){return l(t.min_temp)}),v=d3.svg.line().x(function(t){return o(t.date)}).y(function(t){return l(t.max_temp)});u.append("path").attr("class","minLine").attr("d",g(r)),u.append("path").attr("class","maxLine").attr("d",v(r)),u.selectAll("dot").data(r).enter().append("circle").attr("class","min-temp-chart-circle").attr("r",5).attr("cx",function(t){return o(t.date)}).attr("cy",function(t){return l(t.min_temp)}).on("mouseover",function(t){p.transition().duration(100).style("opacity",0),p.transition().duration(200).style("opacity",1),p.html(t.min_temp+"<sup>&deg;</sup>").style("left",d3.select(this).attr("cx")+"px").style("top",d3.select(this).attr("cy")+"px")}).on("mouseout",function(){p.style("opacity",0)}),u.selectAll("dot").data(r).enter().append("circle").attr("class","max-temp-chart-circle").attr("r",5).attr("cx",function(t){return o(t.date)}).attr("cy",function(t){return l(t.max_temp)}).on("mouseover",function(t){p.transition().duration(100).style("opacity",0),p.transition().duration(200).style("opacity",1),p.html(t.max_temp+"<sup>&deg;</sup>").style("left",d3.select(this).attr("cx")+"px").style("top",d3.select(this).attr("cy")+"px")}).on("mouseout",function(){p.style("opacity",0)}),u.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(c),u.append("g").attr("class","y axis").call(d)}function drawSpaceTime(){now=new Date(d3.time.year.floor(new Date));var t=d3.select("#spacetime-wrap"),e=500,a=500,r=Math.min(e,a);radii={sun:r/8,earthOrbit:r/3.3,earth:r/32,marsOrbit:r/2.2,mars:r/48};var n=t.append("svg").attr("width",e).attr("height",a).attr("id","spacetime").append("g").attr("transform","translate("+e/2+","+a/2+")");n.append("circle").attr("class","sun").attr("r",radii.sun).style("fill","rgba(255, 204, 0, 1.0)"),n.append("circle").attr("class","earthOrbit").attr("r",radii.earthOrbit).style("fill","none").style("stroke","rgba(195, 212, 237, 0.22)"),earthOrbitPosition=d3.svg.arc().outerRadius(radii.earthOrbit+1).innerRadius(radii.earthOrbit-1).startAngle(0).endAngle(0),n.append("path").attr("class","earthOrbitPosition").attr("d",earthOrbitPosition).style("fill","rgb(30, 151, 239)"),n.append("circle").attr("class","earth").attr("r",radii.earth).attr("transform","translate(0,"+-radii.earthOrbit+")").style("fill","rgba(113, 170, 255, 1.0)"),day=d3.svg.arc().outerRadius(radii.earth).innerRadius(0).startAngle(0).endAngle(0),n.append("path").attr("class","day").attr("d",day).attr("transform","translate(0,"+-radii.earthOrbit+")").style("fill","rgba(53, 110, 195, 1.0)"),n.append("circle").attr("class","marsOrbit").attr("r",radii.marsOrbit).style("fill","none").style("stroke","rgba(237, 108, 39, 0.25)"),marsOrbitPosition=d3.svg.arc().outerRadius(radii.marsOrbit+1).innerRadius(radii.marsOrbit-1).startAngle(0).endAngle(0),n.append("path").attr("class","marsOrbitPosition").attr("d",marsOrbitPosition).style("fill","rgba(255, 37, 37, 0.75)"),n.append("circle").attr("class","mars").attr("r",radii.mars).attr("transform","translate(0,"+-radii.marsOrbit+")").style("fill","#E95124")}function movePlanets(t){if(t){var e=0;if(365>t)var a=t;else var a=t-365;var r=d3.interpolate(earthOrbitPosition.endAngle()(),2*Math.PI*(a/365)),n=d3.interpolate(marsOrbitPosition.endAngle()(),2*Math.PI*(t/MARS_YEAR_LENGTH))}else var e=800,r=d3.interpolate(earthOrbitPosition.endAngle()(),2*Math.PI*(daysSinceJanFirst/365)),n=d3.interpolate(marsOrbitPosition.endAngle()(),2*Math.PI*(currentSol/MARS_YEAR_LENGTH));d3.transition().duration(e).tween("orbit",function(){return function(t){d3.select(".earthOrbitPosition").attr("d",earthOrbitPosition.endAngle(r(t))),d3.select(".earth").attr("transform","translate("+radii.earthOrbit*Math.sin(r(t)-earthOrbitPosition.startAngle()())+","+-radii.earthOrbit*Math.cos(r(t)-earthOrbitPosition.startAngle()())+")"),d3.select(".marsOrbitPosition").attr("d",marsOrbitPosition.endAngle(n(t))),d3.select(".mars").attr("transform","translate("+radii.marsOrbit*Math.sin(n(t)-marsOrbitPosition.startAngle()())+","+-radii.marsOrbit*Math.cos(n(t)-marsOrbitPosition.startAngle()())+")")}})}function computeSeason(t){var e;return t>=0&&193.3>=t?e="Spring in N. Hemisphere - Dust Storm Season Ends":t>193.3&&371.9>=t?e="Summer in N. Hemisphere":t>371.9&&514.6>=t?e="Autumn in N. Hemisphere - Dust Storm Season":t>514.6&&MARS_YEAR_LENGTH>=t&&(e="Winter in N. Hemisphere - Dust Storm Season"),e}function computeMonthNumber(t){var e;return t>=1&&61.2>=t?e="1":t>61.2&&126.6>=t?e="2":t>126.6&&193.3>=t?e="3":t>193.3&&257.8>=t?e="4":t>257.8&&317.5>=t?e="5":t>317.5&&371.9>=t?e="6":t>371.9&&421.6>=t?e="7":t>421.6&&468.5>=t?e="8":t>468.5&&514.6>=t?e="9":t>514.6&&562>=t?e="10":t>562&&612.9>=t?e="11":t>612.9&&MARS_YEAR_LENGTH>=t&&(e="12"),e}function daysInMonth(t,e){return new Date(e,t,0).getDate()}function computeEarthMonth(t){var e;return t>=1&&t<=dayRange[0]?e="1":t>dayRange[0]&&t<=dayRange[1]?e="2":t>dayRange[1]&&t<=dayRange[2]?e="3":t>dayRange[2]&&t<=dayRange[3]?e="4":t>dayRange[3]&&t<=dayRange[4]?e="5":t>dayRange[4]&&t<=dayRange[5]?e="6":t>dayRange[5]&&t<=dayRange[6]?e="7":t>dayRange[6]&&t<=dayRange[7]?e="8":t>dayRange[7]&&t<=dayRange[8]?e="9":t>dayRange[8]&&t<=dayRange[9]?e="10":t>dayRange[9]&&t<=dayRange[10]?e="11":t>dayRange[10]&&t<=dayRange[11]&&(e="12"),e}var jsonReportLatest,sol,solarLongitue,updatedOn,sol,minTemp,maxTemp,minTempF,maxTempF,pressure,monthNumber,sunrise,sunset,condition,celsiusTemperatureArchive=[],fahrenheitTemperatureArchive=[],archivePage,archivePageKey,numberOfArchivePages,SOL_CURIOSITY_LANDED=319,MARS_YEAR_LENGTH=668.6,solsSinceCuriosityLanded,currentSol;!function(t){"use strict";function e(){function e(t){jsonReportLatest=t.report,updatedOn=t.report.terrestrial_date,sol=t.report.sol,solarLongitue=t.report.ls,minTemp=t.report.min_temp,maxTemp=t.report.max_temp,minTempF=t.report.min_temp_fahrenheit,maxTempF=t.report.max_temp_fahrenheit,condition=t.report.atmo_opacity,window.sessionStorage.setItem("latestReport",JSON.stringify(t))}function a(){var e=new Date,a=Math.abs(e-new Date(updatedOn)),s=Math.floor(a/864e5);solsSinceCuriosityLanded=sol+s,currentSol=solsSinceCuriosityLanded+SOL_CURIOSITY_LANDED-MARS_YEAR_LENGTH,currentSol>MARS_YEAR_LENGTH&&(currentSol-=MARS_YEAR_LENGTH);var o=((solsSinceCuriosityLanded+.04*solsSinceCuriosityLanded)/365).toFixed(1),l=(solsSinceCuriosityLanded/MARS_YEAR_LENGTH).toFixed(1);switch(s){case 0:i.text("Curiosity Sent its last Update today");break;case 1:i.text("Curiosity Sent its last Update "+s+" Earth day ago");break;default:i.text("Curiosity Sent its last Update "+s+" Earth days ago")}r.text(maxTempF).append("<sup>&deg;</sup>"),n.text(minTempF).append("<sup>&deg;</sup>"),t(".sol-total").text(solsSinceCuriosityLanded),t(".year-count").text(o+" Earth Years - "+l+" Mars Years"),t(".ls-num").text(solarLongitue).append("<sup>&deg;</sup>"),t(".sol-num").text(Math.round(currentSol)),t(".mars-month").text(computeMonthNumber(currentSol)),t(".earth-month").text(computeEarthMonth(daysSinceJanFirst)),t(".mars-season").text(computeSeason(currentSol)),t("#orbit-traveler").val(currentSol)}var s="http://marsweather.ingenology.com/v1/latest/?format=jsonp";if(null==sessionStorage.latestReport)t.ajax({url:s,jsonp:"callback",dataType:"jsonp",success:e,complete:function(){a()}});else{var o=JSON.parse(sessionStorage.latestReport);e(o),a()}}function a(e){function a(e){numberOfArchivePages=Math.ceil(e.count/10),t("#time-traveler").attr("max",10*numberOfArchivePages),t.each(e.results,function(t,e){var a={date:e.terrestrial_date,min_temp:e.min_temp,max_temp:e.max_temp},r={date:e.terrestrial_date,min_temp:e.min_temp_fahrenheit,max_temp:e.max_temp_fahrenheit};celsiusTemperatureArchive.push(a),fahrenheitTemperatureArchive.push(r)}),window.sessionStorage.setItem(archivePage+"c",JSON.stringify(celsiusTemperatureArchive)),window.sessionStorage.setItem(archivePage+"f",JSON.stringify(fahrenheitTemperatureArchive))}var r,n=t("button.unit-toggle.unit-active"),i=n.data("unit");if(r="fahrenheit"===i?"f":"c",e){archivePage=e.toString();var s="http://marsweather.ingenology.com/v1/archive/?page="+e+"&format=jsonp"}else{archivePage="1";var s="http://marsweather.ingenology.com/v1/archive/?format=jsonp"}archivePageKey=archivePage+r,null==window.sessionStorage.getItem(archivePageKey)?(console.log("loading archive "+archivePage+" from API..."),t.ajax({url:s,jsonp:"callback",dataType:"jsonp",success:a,complete:function(){drawChart(r),t("#graph-ui").show()},error:function(){t("#temp-graph").append('<h3 class="error">Oh no! Could not fetch the data</h3>')}})):(console.log("using stored data..."),drawChart(r,!0,archivePageKey),t("#graph-ui").show())}var r=t(".temp-max > span"),n=t(".temp-min > span"),i=t(".update-info");t("document").ready(e),a(),t(".unit-toggle").on("click",function(){var e=t(".unit-symbol"),a=t(this),i=a.data("unit");"celsius"===i?(archivePageKey?drawChart("c",!0,archivePage+"c"):drawChart("c"),r.text(maxTemp).append("<sup>&deg;</sup>"),n.text(minTemp).append("<sup>&deg;</sup>"),e.text("( C )").append("<sup>&deg;</sup>"),a.addClass("unit-active").siblings("button").removeClass("unit-active")):(archivePageKey?drawChart("f",!0,archivePage+"f"):drawChart("f"),r.text(maxTempF).append("<sup>&deg;</sup>"),n.text(minTempF).append("<sup>&deg;</sup>"),e.text("( F )").append("<sup>&deg;</sup>"),a.addClass("unit-active").siblings("button").removeClass("unit-active"))}),t("#time-traveler").on("change",function(){var t=this.value/10;celsiusTemperatureArchive.length=0,fahrenheitTemperatureArchive.length=0,a(t)})}(jQuery);var earthOrbitPosition,marsOrbitPosition,day,radii,now,currentEarthYear=(new Date).getFullYear(),daysSinceJanFirst=d3.time.days(new Date(currentEarthYear+"-01-01T00:00:00.000Z"),new Date).length;drawSpaceTime(),function(t){function e(){movePlanets(),r.text("Current Orbit Position in Time"),n.val(Math.round(currentSol)),i.text(Math.round(currentSol)),o.text(computeMonthNumber(currentSol)),s.text(computeSeason(currentSol)),l.text(computeEarthMonth(daysSinceJanFirst))}var a,r=t(".orbit-legend"),n=t("#orbit-traveler"),i=t(".sol-num"),s=t(".mars-season"),o=t(".mars-month"),l=(t(".sol-total"),t(".earth-month"));n.on("input",function(){var t=this.value;a=365>=t?t:t-365,movePlanets(t),r.text("Sol# "+t),i.text(t),s.text(computeSeason(t)),o.text(computeMonthNumber(t)),l.text(computeEarthMonth(a))}),t("#reset").on("click",function(){movePlanets(1),r.text("Planets at position 0"),n.val(0),i.text(0),o.text(computeMonthNumber(0)),s.text(computeSeason(1)),l.text(computeEarthMonth(1))}),t("#current").on("click",e);var c=(t("li[class='active']"),t(".sidebar-nav-icons > li"));c.on("click",function(){var a=t(this),r=a.data("module");switch(r){case"sol":t("#sol-module").addClass("selected").siblings().removeClass("selected"),setTimeout(e,900);break;case"temp":t("#temp-module").addClass("selected").siblings().removeClass("selected");break;case"about":t("#about-module").addClass("selected").siblings().removeClass("selected")}return a.hasClass("active")?!1:(a.siblings("li").removeClass("active"),void a.addClass("active"))})}(jQuery);for(var dayRange=[],prevMonthLenth=0,i=1;12>=i;i++){var monthLen=daysInMonth(i,currentEarthYear);dayRange.push(monthLen+prevMonthLenth),prevMonthLenth+=monthLen}